<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Dashboard - AI Lead Intelligence</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar { height: 100vh; background: #2c3e50; color: white; padding-top: 20px; }
        .sidebar a { color: white; text-decoration: none; display: block; padding: 10px 20px; }
        .sidebar a:hover { background: #34495e; }
        .stat-card { border-radius: 10px; padding: 20px; color: white; margin-bottom: 20px; }
        .bg-hot { background: #e74c3c; }
        .bg-warm { background: #f39c12; }
        .bg-cold { background: #3498db; }
        .bg-total { background: #2ecc71; }
        .lead-table { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar d-none d-md-block">
                <h4 class="text-center">UAE AI Lead</h4>
                <hr>
                <a href="/dashboard">Dashboard</a>
                <a href="/">Public Form</a>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Real Estate Lead Dashboard</h2>
                    <span class="text-muted">Welcome back, Agent</span>
                </div>

                <!-- Stats -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-card bg-total">
                            <h5>Total Leads</h5>
                            <h2>{{ stats.total }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-hot">
                            <h5>üî• HOT Leads</h5>
                            <h2>{{ stats.hot }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-warm">
                            <h5>‚ö†Ô∏è WARM Leads</h5>
                            <h2>{{ stats.warm }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-cold">
                            <h5>Avg Response Time</h5>
                            <h2>{{ stats.avg_response|round(1) }} min</h2>
                        </div>
                    </div>
                </div>

                <!-- Lead Table -->
                <div class="lead-table mt-4">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Name</th>
                                <th>Budget</th>
                                <th>Area</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th>Prob.</th>
                                <th>Created</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lead in leads %}
                            <tr>
                                <td>
                                    <strong>{{ lead.name }}</strong><br>
                                    <small class="text-muted">{{ lead.phone }}</small>
                                </td>
                                <td>{{ lead.budget|int }} AED</td>
                                <td>{{ lead.area }}</td>
                                <td>{{ lead.score }}</td>
                                <td>
                                    {% if lead.lead_status == 'HOT' %}
                                        <span class="badge bg-danger">HOT</span>
                                    {% elif lead.lead_status == 'WARM' %}
                                        <span class="badge bg-warning text-dark">WARM</span>
                                    {% else %}
                                        <span class="badge bg-info">COLD</span>
                                    {% endif %}
                                </td>
                                <td>{{ lead.close_probability }}%</td>
                                <td>{{ lead.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                <td>
                                    {% if not lead.last_contacted %}
                                        <form action="/mark-contacted/{{ lead.id }}" method="post" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-success">Mark Contacted</button>
                                        </form>
                                    {% else %}
                                        <span class="text-success">‚úì {{ lead.response_time_minutes|round(1) }}m</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                            {% if not leads %}
                            <tr>
                                <td colspan="8" class="text-center py-4">No leads found yet.</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
